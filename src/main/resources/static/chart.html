<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>welcome to nurse hoursing</title>

    <link rel="stylesheet" href="./layui/css/layui.css">
    <link rel="stylesheet" href="./css/chart.css">
    <script type="text/javascript" src="/js/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="/js/angular.min.js"></script>
    <script src="../layui/layui.js"></script>
    <script src="./js/home.js"></script>
</head>


<body>
<div class="header">
    <div><img src="./images/nursing-home-icon-1.jpg" style="width: 50px;height: 50px"></div>
    <div class="header-title">
        <span>HAPPY NURSING HOME</span>
    </div>
    <div>
        <i class="layui-icon layui-icon-service" style="font-size: 50px; color: #1E9FFF;"></i>
    </div>
    <div>
        <span class="hotline-label">TEL:</span>
        <div class="hotline-txt">083-024-xxxx</div>
    </div>

</div>
<h2 class="title-1"><span style="color: red">Male's</span> average life expectancy and years.</h2>
<div class="chart1">
    <input id="users" type="hidden" th:value="${users}" readonly="true" style="background:#CCCCCC">

    <div class="chart1-1">
        <div class="chart1-1-1">
            <div>
                <div class="layui-input-block">
                    <button type="button" id="showChart1" onclick="showChart1()" class="layui-btn"
                            lay-filter="showChart1">Show AvgLife_Year(male)
                    </button>
                </div>
            </div>
            <div>
                <img id="AvgLife_Year_male" src="http://localhost:8000/AvgLife_Year(male).png">
            </div>
        </div>
        <div class="chart1-1-2">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;font-size: 2em">
                <legend>The average life of male</legend>
            </fieldset>
            <ul class="layui-timeline">
                <li class="layui-timeline-item">
                    <i class="layui-icon layui-timeline-axis"></i>
                    <div class="layui-timeline-content layui-text">
                        <div class="layui-timeline-title">in 2000, was about 73 years.</div>
                    </div>
                </li>
                <li class="layui-timeline-item">
                    <i class="layui-icon layui-timeline-axis"></i>
                    <div class="layui-timeline-content layui-text">
                        <div class="layui-timeline-title">in 2005 was about 74.5 years.</div>
                    </div>
                </li>
                <li class="layui-timeline-item">
                    <i class="layui-icon layui-timeline-axis"></i>
                    <div class="layui-timeline-content layui-text">
                        <div class="layui-timeline-title">in 2010 was about 77 years.</div>
                    </div>
                </li>
                <li class="layui-timeline-item">
                    <i class="layui-icon layui-timeline-axis"></i>
                    <div class="layui-timeline-content layui-text">
                        <div class="layui-timeline-title">in 2015 was about 77 years.</div>
                    </div>
                </li>
                <li class="layui-timeline-item">
                    <i class="layui-icon layui-anim layui-anim-rotate layui-anim-loop layui-timeline-axis"></i>
                    <div class="layui-timeline-content layui-text">
                        <div class="layui-timeline-title">and so on</div>
                    </div>
                </li>
            </ul>

            <form class="layui-form">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="">Expectancy Age:</label>
                        <div class="layui-input-inline">
                            <input type="text" id="maleExpectancyAge" name="expectancyAge" autocomplete="off"
                                   class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="">Target year:</label>
                        <div class="layui-input-inline">
                            <input type="text" id="targetYear" name="targetYear" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button type="submit" class="layui-btn" lay-submit="" lay-filter="maleExpectancyAge">Submit
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <div class="chart1-1-3">
            <table class="layui-table" lay-even="" lay-skin="row">
                <colgroup>
                    <col width="150">
                    <col width="150">
                    <col width="200">
                    <col>
                </colgroup>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Birth year</th>
                    <!--                    <th>Stay Time</th>-->
                    <th>Age</th>
                    <!--                    <th>Checkin</th>-->
                    <th>Year</th>
                    <th>Gender</th>
                </tr>
                </thead>
                <tbody id="person_info_list1">

                </tbody>
            </table>
            <div id="demo20"></div>
            <ul id="biuuu_city_list"></ul>
        </div>
    </div>

    <h2 class="title-2"><span style="color: red">Female's</span> average life expectancy and years.</h2>

    <div class="chart1-2">

        <div class="chart1-2-1">
            <div>
                <div class="layui-input-block">
                    <button type="button" id="showChart2" onclick="showChart2()" class="layui-btn"
                            lay-filter="showChart2">Show AvgLife_Year(female)
                    </button>
                </div>
            </div>
            <div>
                <img id="AvgLife_Year_female" src="http://localhost:8000/AvgLife_Year(female).png">
            </div>
        </div>

        <div class="chart1-2-2">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;font-size: 2em">
                <legend>The average life of female</legend>
            </fieldset>
            <ul class="layui-timeline">
                <li class="layui-timeline-item">
                    <i class="layui-icon layui-timeline-axis"></i>
                    <div class="layui-timeline-content layui-text">
                        <div class="layui-timeline-title">in 2000, was about 73 years.</div>
                    </div>
                </li>
                <li class="layui-timeline-item">
                    <i class="layui-icon layui-timeline-axis"></i>
                    <div class="layui-timeline-content layui-text">
                        <div class="layui-timeline-title">in 2005 was about 74.5 years.</div>
                    </div>
                </li>
                <li class="layui-timeline-item">
                    <i class="layui-icon layui-timeline-axis"></i>
                    <div class="layui-timeline-content layui-text">
                        <div class="layui-timeline-title">in 2010 was about 77 years.</div>
                    </div>
                </li>
                <li class="layui-timeline-item">
                    <i class="layui-icon layui-timeline-axis"></i>
                    <div class="layui-timeline-content layui-text">
                        <div class="layui-timeline-title">in 2015 was about 77 years.</div>
                    </div>
                </li>
                <li class="layui-timeline-item">
                    <i class="layui-icon layui-anim layui-anim-rotate layui-anim-loop layui-timeline-axis"></i>
                    <div class="layui-timeline-content layui-text">
                        <div class="layui-timeline-title">and so on</div>
                    </div>
                </li>
            </ul>

            <form class="layui-form">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="">Expectancy Age:</label>
                        <div class="layui-input-inline">
                            <input type="text" id="femaleExpectancyAge" name="expectancyAge" autocomplete="off"
                                   class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="">Target year:</label>
                        <div class="layui-input-inline">
                            <input type="text" id="targetYear2" name="targetYear2" autocomplete="off"
                                   class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button type="submit" class="layui-btn" lay-submit="" lay-filter="femaleExpectancyAge">Submit
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <div class="chart1-2-3">
            <table class="layui-table" lay-even="" lay-skin="row">
                <colgroup>
                    <col width="150">
                    <col width="150">
                    <col width="200">
                    <col>
                </colgroup>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Birth year</th>
                    <!--                    <th>Stay Time</th>-->
                    <!--                    <th>Checkin</th>-->
                    <th>Age</th>
                    <th>Year</th>
                    <th>Gender</th>
                </tr>
                </thead>
                <tbody id="person_info_list2">

                </tbody>
            </table>
            <div id="demo202"></div>
            <ul id="biuuu_city_list2"></ul>
        </div>

    </div>

    <h2 class="title-3">Future life trends.</h2>
    <div class="chart1-3">
        <div class="chart1-3-1">
            <div style="text-align: center;font-size: 2em"><span style="color: red">Male's</span> life expectancy trend.
            </div>
            <div>
                <form class="layui-form layui-form-pane" action="">
                    <div class="layui-form-item">
                        <label class="layui-form-label">Year</label>
                        <div class="layui-input-block">
                            <select name="MaleLifeExpectancy" lay-filter="MaleLifeExpectancy">
                                <option value="" selected="">please select an option</option>
                                <option value="2022,2024,2026,2028,2030">2022,2024,2026,2028,2030</option>
                                <option value="2030,2035,2040,2045,2050,2055,2060">2030,2035,2040,2045,2050,2055,2060
                                </option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="chart1-3-2">
            <div class="chart1-3-1">
                <div style="text-align: center;font-size: 2em"><span style="color: red">Female's</span> life expectancy
                    trend.
                </div>
                <div>
                    <form class="layui-form layui-form-pane" action="">
                        <div class="layui-form-item">
                            <label class="layui-form-label">Year</label>
                            <div class="layui-input-block">
                                <select name="FemaleLifeExpectancy" lay-filter="FemaleLifeExpectancy">
                                    <option value="" selected="">please select an option</option>
                                    <option value="2022,2024,2026,2028,2030">2022,2024,2026,2028,2030</option>
                                    <option value="2030,2035,2040,2045,2050,2055,2060">
                                        2030,2035,2040,2045,2050,2055,2060
                                    </option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!--   MaleLifeExpectancy IMG     -->
        <div class="chart1-3-3">
            <img id="MaleLifeExpectancyIMG" src="http://localhost:8000/LifeExpectancy(Male2022 - 2030).png">
        </div>
        <div class="chart1-3-4">
            <img id="FemaleLifeExpectancyIMG" src="http://localhost:8000/LifeExpectancy(female2022 - 2030).png">

        </div>
    </div>
    <div class="chart1-4">
        <div class="chart1-4-1">
            <img src="http://localhost:8000/Age_StayTime.png">
        </div>
        <div class="chart1-4-2">
            22
        </div>
    </div>


</div>
<br>


<script>
    /*The average life of male - Table*/
    layui.use(['laypage', 'layer'], function () {
        var laypage = layui.laypage
            , layer = layui.layer;
        var jsonStr = $("#users").attr("value");
        var jsonArray = jQuery.parseJSON(jsonStr);

        for (let i = 0, len = jsonArray.length; i < len; i++) {
            let jsonArrayElement = jsonArray[i];
            if (jsonArrayElement != undefined) {
                let gender = jsonArrayElement.gender;
                if (gender != "male") {
                    jsonArray.splice(i, 1);
                    i--;
                    console.log();
                }
                console.log();
            }
        }

        laypage.render({
            elem: 'demo20'
            , count: jsonArray.length
            , prev: '<em>←</em>'
            , next: '<em>→</em>'
            , jump: function (obj) {
                document.getElementById('person_info_list1').innerHTML = function () {
                    var arr = []
                        , thisData = jsonArray.slice().splice(obj.curr * obj.limit - obj.limit, obj.limit);
                    while (obj.curr < (jsonArray.length / 10 + 1)) {
                        layui.each(thisData, function (index, item) {

                            var checkinTimeYear;
                            if (item.checkinTime != null) {
                                var checkinTimeS = item.checkinTime.time;
                                var checkinTimeDate = new Date(checkinTimeS);
                                checkinTimeYear = checkinTimeDate.getFullYear();
                            }


                            var checkoutTimeYear;
                            if (item.checkoutTime != null) {
                                var checkinTimeS = item.checkoutTime.time;
                                var checkoutTimeDate = new Date(checkinTimeS);
                                checkoutTimeYear = checkoutTimeDate.getFullYear();
                            }

                            var birthdayYear = new Date(item.birthday);
                            var birthday = birthdayYear.getFullYear();
                            let age = checkoutTimeYear - birthday;
                            let gender = item.gender;
                            arr.push('<tr>');
                            arr.push('<td>' + item.id + '</td>');
                            arr.push('<td>' + birthday + '</td>');
                            // arr.push('<td>' + (checkoutTimeYear - checkinTimeYear) + '</td>');
                            arr.push('<td>' + age + '</td>');
                            // arr.push('<td>' + checkinTimeYear + '</td>');
                            arr.push('<td>' + checkoutTimeYear + '</td>');
                            arr.push('<td>' + gender + '</td>');
                            arr.push('</tr>');
                        });
                        return arr.join('');
                    }
                }();
            }
        });
    });

    /*The average life of female - Table*/
    layui.use(['laypage', 'layer'], function () {
        var laypage = layui.laypage
            , layer = layui.layer;
        var jsonStr = $("#users").attr("value");
        var jsonArray = jQuery.parseJSON(jsonStr);

        for (let i = 0, len = jsonArray.length; i < len; i++) {
            let jsonArrayElement = jsonArray[i];
            if (jsonArrayElement != undefined) {
                let gender = jsonArrayElement.gender;
                if (gender != "female") {
                    jsonArray.splice(i, 1);
                    i--;
                    console.log();
                }
                console.log();
            }
        }

        laypage.render({
            elem: 'demo202'
            , count: jsonArray.length
            , prev: '<em>←</em>'
            , next: '<em>→</em>'
            , jump: function (obj) {
                document.getElementById('person_info_list2').innerHTML = function () {
                    var arr = []
                        , thisData = jsonArray.slice().splice(obj.curr * obj.limit - obj.limit, obj.limit);
                    while (obj.curr < (jsonArray.length / 10 + 1)) {
                        layui.each(thisData, function (index, item) {

                            var checkinTimeYear;
                            if (item.checkinTime != null) {
                                var checkinTimeS = item.checkinTime.time;
                                var checkinTimeDate = new Date(checkinTimeS);
                                checkinTimeYear = checkinTimeDate.getFullYear();
                            }


                            var checkoutTimeYear;
                            if (item.checkoutTime != null) {
                                var checkinTimeS = item.checkoutTime.time;
                                var checkoutTimeDate = new Date(checkinTimeS);
                                checkoutTimeYear = checkoutTimeDate.getFullYear();
                            }

                            var birthdayYear = new Date(item.birthday);
                            var birthday = birthdayYear.getFullYear();
                            let age = checkoutTimeYear - birthday;
                            let gender = item.gender;
                            arr.push('<tr>');
                            arr.push('<td>' + item.id + '</td>');
                            arr.push('<td>' + birthday + '</td>');
                            // arr.push('<td>' + (checkoutTimeYear - checkinTimeYear) + '</td>');
                            arr.push('<td>' + age + '</td>');
                            // arr.push('<td>' + checkinTimeYear + '</td>');
                            arr.push('<td>' + checkoutTimeYear + '</td>');
                            arr.push('<td>' + gender + '</td>');
                            arr.push('</tr>');
                        });
                        return arr.join('');
                    }
                }();
            }
        });
    });


    layui.use('form', function () {
        let form = layui.form;
        form.render();
        form.on('submit(maleExpectancyAge)', function (data) {
            let expectancyAge = $("#maleExpectancyAge").val();
            let postData = {
                gender: "male",
                expectancyAge: expectancyAge
            }
            if (expectancyAge !== null && expectancyAge !== "") {
                $.ajax({
                    url: "/expectancyAge"
                    , data: postData
                    , type: "post"
                    , success: function (data) {
                        console.log(data);
                        $("#targetYear").val(data.year);
                    }
                })
            } else {
                layer.open({
                    title: 'Notice'
                    , content: "Please Input An Expectancy Age"
                });
                return false;
            }
            return false;
        })
        return false;
    });


    layui.use('form', function () {
        let form = layui.form;
        form.render();
        form.on('submit(femaleExpectancyAge)', function (data) {
            let expectancyAge = $("#femaleExpectancyAge").val();
            let postData = {
                gender: "female",
                expectancyAge: expectancyAge
            }
            if (expectancyAge !== null && expectancyAge !== "") {
                $.ajax({
                    url: "/expectancyAge"
                    , data: postData
                    , type: "post"
                    , success: function (data) {
                        console.log(data);
                        $("#targetYear2").val(data.year);
                    }
                })
            } else {
                layer.open({
                    title: 'Notice'
                    , content: "Please Input An Expectancy Age"
                });
                return false;
            }
            return false;
        })
        return false;
    });


    $(document).ready(function () {
        // $("#showChart1").click();
        // <button type="button" onclick="showChart1()" class="layui-btn" lay-submit="" lay-filter="showChart1">Show AvgLife_Year(male)</button>
    });

    function showChart1() {
        let postData = {
            gender: "male"
        }
        $.ajax({
            type: 'post',
            url: '/generateAvgLifeYear',
            data: {},
            cache: false,
            dataType: 'json',
            data: postData,
            success: function (data) {
                var fileName = data.fileName;
                $("#AvgLife_Year_male").attr("src", "http://localhost:8000/" + fileName);
                console.log(data);
            },
            error: function () {
                console.log();
            }
        });
    }


    function showChart2() {
        var postData = {
            gender: "female"
        }

        $.ajax({
            type: 'post',
            url: '/generateAvgLifeYear',
            data: {},
            cache: false,
            dataType: 'json',
            data: postData,
            success: function (data) {
                var fileName = data.fileName;
                $("#AvgLife_Year_female").attr("src", "http://localhost:8000/" + fileName);
                console.log(data);
            },
            error: function () {
                console.log();
            }
        });
    }


    layui.use(['layer', 'jquery', 'form'], function () {
        let layer = layui.layer,
            $ = layui.jquery,
            form = layui.form;
        form.on('select(MaleLifeExpectancy)', function (data) {
            let year = data.value;
            let postData = {
                year: data.value,
                gender: "male"
            }
            if (year !== null && year !== "") {
                $.ajax({
                    url: "/generateLifeExpectancy"
                    , dataType: "json"
                    , data: postData
                    , type: "post"
                    , success: function (data) {
                        var fileName = data.fileName;
                        $("#MaleLifeExpectancyIMG").attr("src", "http://localhost:8000/" + fileName);
                        console.log(fileName);
                    }
                })
            } else {
                layer.open({
                    title: 'Notice'
                    , content: "Please select an year range"
                });
                return false;
            }
            return false;
        });

        form.on('select(FemaleLifeExpectancy)', function (data) {
            let year = data.value;
            let postData = {
                year: data.value,
                gender: "female"
            }
            if (year !== null && year !== "") {
                $.ajax({
                    url: "/generateLifeExpectancy"
                    , dataType: "json"
                    , data: postData
                    , type: "post"
                    , success: function (data) {
                        let fileName = data.fileName;
                        $("#FemaleLifeExpectancyIMG").attr("src", "http://localhost:8000/" + fileName);
                        console.log(fileName);
                    }
                })
            } else {
                layer.open({
                    title: 'Notice'
                    , content: "Please select an year range"
                });
                return false;
            }
            return false;
        });
    });


</script>

</body>
</html>